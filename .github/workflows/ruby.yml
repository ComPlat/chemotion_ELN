name: ELN GitHub Actions 3

on:
  push:
    branches: [ github-actions ]

  workflow_dispatch:

jobs:

  docker_container:
    runs-on: ubuntu-latest
    container: 
      image: complat/complat-ubuntu-runner:0.12.20
    services:
      postgres:
        image: postgres
        ports:
          - 5432:5432
        env:
          POSTGRES_PASSWORD: postgres
        options: >-
          --health-cmd pg_isready 
          --health-interval 10s 
          --health-timeout 5s 
          --health-retries 5
    steps:
      - name: git clone
        working-directory: /home/gitlab-runner
        env:
          POSTGRES_HOST: postgres
          POSTGRES_PORT: 5432
        run: |
            whoami
            # sudo apt-get -y update -qq
            # sudo apt-get -y install postgresql postgresql-contrib libpq-dev
            # TODO
            #sudo git clone --branch development --depth 1 https://github.com/ComPlat/chemotion_ELN.git 
            echo "POSTGRES"
            which psql
            psql --version
            # echo "RAM"
            # free -g
            #/etc/init.d/postgresql status
            # error 3
            #/etc/init.d/postgresql start
            #echo "SUDOERS"
            #sudo cat /etc/sudoers
            psql -d postgresql://postgres:postgres@localhost/postgres -c "\du"
            # sudo -Hu postgres pg_ctlcluster 12 main status
            # echo "ALLL FILES?"
            # whoami
            # pwd 
            # ls -la